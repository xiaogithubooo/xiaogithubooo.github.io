<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/2/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/12/01/008+limou+2023_09_15+C++%E4%BB%BF%E5%87%BD%E6%95%B0%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/12/01/008+limou+2023_09_15+C++%E4%BB%BF%E5%87%BD%E6%95%B0%E5%8E%9F%E7%90%86/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-12-01T16:34:49+08:00">
                2023-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="1-仿函数概念"><a href="#1-仿函数概念" class="headerlink" title="1.仿函数概念"></a>1.仿函数概念</h1><p>仿函数（<code>Functor</code>）是指可以像函数一样被调用的对象，因此有一个很明显的特征就是会重载<code>()</code>符号，从而使对象具有了函数的行为。</p>
<p>使用仿函数可以将对象作为函数一样进行调用，这种调用行为类似于函数调用。可以像调用函数一样使用参数传递给仿函数，并获取返回值。</p>
<p>这使得对象具备了函数的功能，可以方便地实现自定义的操作或算法。</p>
<h1 id="2-仿函数代码"><a href="#2-仿函数代码" class="headerlink" title="2.仿函数代码"></a>2.仿函数代码</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个仿函数</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Adder</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="type">const</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个仿函数对象</span></span><br><span class="line">    Adder add;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用仿函数进行调用，类似于函数调用</span></span><br><span class="line">    <span class="type">int</span> result = <span class="built_in">add</span>(<span class="number">3</span>, <span class="number">5</span>);<span class="comment">//单看这一行您可能会认为这里调用了一个函数，实际上这是一个对象</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上述示例中，我们定义了一个名为 <code>Adder&#123;&#125;</code> 的仿函数结构体，重载了 <code>operator()</code> 函数。这个仿函数接受两个整数作为参数，并返回它们的和。</p>
<p>在 <code>main()</code> 函数中，我们创建了一个 <code>Adder</code> 对象 <code>add</code>，并使用它来执行加法操作。</p>
<h1 id="3-仿函数作用"><a href="#3-仿函数作用" class="headerlink" title="3.仿函数作用"></a>3.仿函数作用</h1><p>通过仿函数的使用，我们可以将对象看作是函数并进行调用，这在某些情况下可以提供更灵活和可定制的行为，好处是能更好做类型，替代<code>C</code>的函数回调行为（<code>C</code>使用函数指针来回调函数）例如：<code>c</code>的<code>qsort()</code>一般使用函数指针，但是<code>C++</code>的<code>sort()</code>更多使用仿函数。但是目前我们还没有办法更加深入体会，随着后续的使用您才可以体验到仿函数的作用。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/12/01/005+limou+2023_10_09+C++%E7%B1%BB%E7%9A%84%E5%AE%9E%E8%B7%B5%E8%BF%90%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/12/01/005+limou+2023_10_09+C++%E7%B1%BB%E7%9A%84%E5%AE%9E%E8%B7%B5%E8%BF%90%E7%94%A8/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-12-01T16:34:49+08:00">
                2023-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="1-日期类接口概要（接口）"><a href="#1-日期类接口概要（接口）" class="headerlink" title="1.日期类接口概要（接口）"></a>1.日期类接口概要（接口）</h1><p>本次主要是来书写一个<code>C++</code>日期类的实现，下面我会给出一个日期类的大概框架，以及具体要实现的接口函数，您可以先试着自己实现一下，然后再来看我的具体代码实现。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="comment">//1.全缺省的构造函数（使用了初始化列表）</span></span><br><span class="line">    Date(<span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day);</span><br><span class="line">    <span class="comment">//2.拷贝构造函数</span></span><br><span class="line">    <span class="comment">//d2(d1)</span></span><br><span class="line">    Date(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//3.赋值运算符重载函数</span></span><br><span class="line">    <span class="comment">//d2 = d3 --&gt; d2.operator=(&amp;d2, d3)</span></span><br><span class="line">    Date&amp; operator=(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//4.析构函数</span></span><br><span class="line">    ~Date();</span><br><span class="line">    <span class="comment">//5.符号重载函数</span></span><br><span class="line">    <span class="comment">//获取某年某月的天数</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">GetMonthDay</span><span class="params">(<span class="type">int</span> year, <span class="type">int</span> month)</span>;</span><br><span class="line">    <span class="comment">//日期+=天数重载</span></span><br><span class="line">    Date&amp; operator+=(<span class="type">int</span> day);</span><br><span class="line">    <span class="comment">//日期+天数运算符重载</span></span><br><span class="line">    Date operator+(<span class="type">int</span> day);</span><br><span class="line">    <span class="comment">//日期-=天数运算符重载</span></span><br><span class="line">    Date&amp; operator-=(<span class="type">int</span> day);</span><br><span class="line">    <span class="comment">//日期-天数运算符重载</span></span><br><span class="line">    Date operator-(<span class="type">int</span> day);</span><br><span class="line">    <span class="comment">//前置++运算符重载</span></span><br><span class="line">    Date&amp; operator++();</span><br><span class="line">    <span class="comment">//后置++运算符重载</span></span><br><span class="line">    Date operator++(<span class="type">int</span>);</span><br><span class="line">    <span class="comment">//前置--运算符重载</span></span><br><span class="line">    Date&amp; operator--();</span><br><span class="line">    <span class="comment">//后置--运算符重载</span></span><br><span class="line">    Date operator--(<span class="type">int</span>);</span><br><span class="line">    <span class="comment">//&gt;运算符重载</span></span><br><span class="line">    <span class="type">bool</span> operator&gt;(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//==运算符重载</span></span><br><span class="line">    <span class="type">bool</span> operator==(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//!=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> operator!=(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//&gt;=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> operator&gt;=(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//&lt;运算符重载</span></span><br><span class="line">    <span class="type">bool</span> operator&lt;(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//&lt;=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> operator&lt;=(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//日期-日期=返回天数运算符重载</span></span><br><span class="line">    <span class="type">int</span> operator-(<span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">//6.打印日期类函数</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">Print</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">private:</span><br><span class="line">    <span class="type">int</span> _year;</span><br><span class="line">    <span class="type">int</span> _month;</span><br><span class="line">    <span class="type">int</span> _day;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="2-日期类详细解析（细节）"><a href="#2-日期类详细解析（细节）" class="headerlink" title="2.日期类详细解析（细节）"></a>2.日期类详细解析（细节）</h1><h2 id="2-1-构造和析构函数"><a href="#2-1-构造和析构函数" class="headerlink" title="2.1.构造和析构函数"></a>2.1.构造和析构函数</h2><h3 id="2-1-1-构造函数"><a href="#2-1-1-构造函数" class="headerlink" title="2.1.1.构造函数"></a>2.1.1.构造函数</h3><p>首先我们需要书写一个构造函数<code>Date()</code>，这个构造函数能够在没有指定年月日的情况下，拥有默认&#x2F;缺省值<code>1900年1月1日</code>。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//1.全缺省的构造函数（使用了初始化列表）</span></span><br><span class="line">    <span class="built_in">Date</span>(<span class="type">int</span> year = <span class="number">1900</span>, <span class="type">int</span> month = <span class="number">1</span>, <span class="type">int</span> day = <span class="number">1</span>)</span><br><span class="line">        : _year(year),</span><br><span class="line">        _month(month),</span><br><span class="line">        _day(day)<span class="comment">//这里也可以不使用初始化列表，如果您尚未了解过该语法可以注释掉“ _year(year),_month(month),_day(day)”这一部分</span></span><br><span class="line">    &#123;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _year;</span><br><span class="line">    <span class="type">int</span> _month;</span><br><span class="line">    <span class="type">int</span> _day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>并且我们需要可以帮助我们检查日期合法性的函数，因此我们书写一个<code>GetMonthDay()</code>来获取在不同年份以及不同月份的请款下正确的天数是多少。为什么不直接检查用户给予我们的值是否正确，而是要获取正确的天数呢？因为这个获取正确天数的函数<code>GetMonthDay()</code>在后续还有些许应用。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//获取某年某月的天数</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetMonthDay</span><span class="params">(<span class="type">int</span> year, <span class="type">int</span> month)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">static</span> <span class="type">int</span> monthDays[<span class="number">13</span>] = &#123; <span class="number">0</span>, <span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span> &#125;;<span class="comment">//这个静态的编写是因为GetMonthDay有可能会被频繁调用，那么monthDays数组就会不断的被创建，虽然这点消耗挺小，但是如果加上静态关键字，这个数组就会一直存在，不会被反复创建，节省资源。</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        日志：</span></span><br><span class="line"><span class="comment">        一个年份是闰年的条件如下：</span></span><br><span class="line"><span class="comment">        1.如果该年份能够被4整除，但不能被100整除，则为闰年。例如：2008年、2012年等。</span></span><br><span class="line"><span class="comment">        2.如果该年份能够被400整除，则也是闰年。例如：2000年、2400年等。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (month == <span class="number">2</span></span><br><span class="line">            &amp;&amp; ((year % <span class="number">4</span> == <span class="number">0</span>) &amp;&amp; ((year % <span class="number">100</span> != <span class="number">0</span>) || (year % <span class="number">400</span> == <span class="number">0</span>)))</span><br><span class="line">            )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">29</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> monthDays[month];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//1.全缺省的构造函数（使用了初始化列表）</span></span><br><span class="line">    <span class="built_in">Date</span>(<span class="type">int</span> year = <span class="number">1900</span>, <span class="type">int</span> month = <span class="number">1</span>, <span class="type">int</span> day = <span class="number">1</span>)</span><br><span class="line">        : _year(year),</span><br><span class="line">        _month(month),</span><br><span class="line">        _day(day)<span class="comment">//这里也可以不使用初始化列表，如果您尚未了解过该语法可以注释掉“ _year(year),_month(month),_day(day)”这一部分</span></span><br><span class="line">           <span class="keyword">if</span> ((_month &lt; <span class="number">1</span>) || (_month &gt; <span class="number">12</span>) </span><br><span class="line">                || _day &lt; <span class="number">1</span> || (<span class="built_in">GetMonthDay</span>(_year, _month) &lt; _day))</span><br><span class="line">        &#123;</span><br><span class="line">                  cout &lt;&lt; <span class="string">&quot;非法日期：&quot;</span>;</span><br><span class="line">                <span class="built_in">Print</span>();</span><br><span class="line">              cout &lt;&lt; endl;</span><br><span class="line">                  <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _year;</span><br><span class="line">    <span class="type">int</span> _month;</span><br><span class="line">    <span class="type">int</span> _day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-2-析构函数"><a href="#2-1-2-析构函数" class="headerlink" title="2.1.2.析构函数"></a>2.1.2.析构函数</h3><p>关于日期类，由于成员变量里面没有使用堆资源，因此其实不需要我们编写析构函数。但是为了凸显析构的存在，达到训练的目的，可以让析构执行一些打印工作。</p>
<blockquote>
<p>注意：这里只是演示析构会被编译器自动调用，实际使用析构是不会这么用的）。</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4.析构函数</span></span><br><span class="line">~<span class="built_in">Date</span>()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;析构函数在这个日期类里面没有太大用处:~Data()&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际使用的日期类过程中也可以注释掉这个自定义的析构函数，编译器帮我们生成的析构函数已经够“用”了。</p>
<p>实际上就算是编译器生成的析构函数也没做什么，因为没什么资源（例如：在堆空间上申请的资源）可以析构的。</p>
<p>编译器默认的析构函数不会对内置类型做什么，而日期类的成员变量也没有自定义类型，因此也不会调用自定义类型的析构函数。</p>
<h2 id="2-2-日期对象打印函数"><a href="#2-2-日期对象打印函数" class="headerlink" title="2.2.日期对象打印函数"></a>2.2.日期对象打印函数</h2><p>我们还需要检验一下我们的构造函数工作得怎么样了，因此需要编写一个打印函数打印日期对象内部的成员变量。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//6.打印日期类函数void Print(void)</span></span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; _year &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; _month &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; _day &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-拷贝构造和赋值运算符重载函数"><a href="#2-3-拷贝构造和赋值运算符重载函数" class="headerlink" title="2.3.拷贝构造和赋值运算符重载函数"></a>2.3.拷贝构造和赋值运算符重载函数</h2><p>接下来就要考虑两种情况：拷贝和构造。</p>
<ol>
<li><p>拷贝构造主要解决了：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Date <span class="title">d1</span><span class="params">(<span class="number">2023</span>, <span class="number">7</span>, <span class="number">29</span>)</span></span>;</span><br><span class="line"><span class="function">Date <span class="title">d2</span><span class="params">(d1)</span></span>;<span class="comment">//将d2初始化为d1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>而赋值运算符重载则解决了：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Date <span class="title">d3</span><span class="params">(<span class="number">2023</span>, <span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line"><span class="function">Date <span class="title">d4</span><span class="params">(<span class="number">2023</span>, <span class="number">3</span>, <span class="number">9</span>)</span></span>;</span><br><span class="line">d3 = d4;<span class="comment">//将对象d4的内容赋值给d3</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-3-1-拷贝构造函数"><a href="#2-3-1-拷贝构造函数" class="headerlink" title="2.3.1.拷贝构造函数"></a>2.3.1.拷贝构造函数</h3><p>由于拷贝构造函数不像构造和析构函数，它对内置类型是会自动进行拷贝处理的。</p>
<p>也就是说，我们其实也无需自定义拷贝构造函数，使用默认的即可，但是您也可以试着像下面一样写一下 。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.拷贝构造函数</span></span><br><span class="line"><span class="comment">//d2(d1)</span></span><br><span class="line"><span class="built_in">Date</span>(<span class="type">const</span> Date&amp; d)<span class="comment">//实际可以不写这个拷贝构造，只用编译器默认生成的就可以了，需要注意这里要使用引用</span></span><br><span class="line">&#123;</span><br><span class="line">    _year = d._year;</span><br><span class="line">    _month = d._month;</span><br><span class="line">    _day = d._day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-赋值运算符重载"><a href="#2-3-2-赋值运算符重载" class="headerlink" title="2.3.2.赋值运算符重载"></a>2.3.2.赋值运算符重载</h3><p>赋值运算符重载也是可以不用书写的，编译器也同样会默认生成一个赋值重载。</p>
<p>这也是因为日期类没有自定义类型的成员，只需要浅拷贝即可，但是您也可以如下面代码写出来：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.赋值运算符重载函数</span></span><br><span class="line"><span class="comment">//d2 = d3 --&gt; d2.operator=(&amp;d2, d3)</span></span><br><span class="line"><span class="type">void</span> <span class="keyword">operator</span>=(<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    _year = d._year;</span><br><span class="line">    _month = d._month;</span><br><span class="line">    _day = d._day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里的形式参数<code>const Date&amp; d</code>其实也不是一定要使用引用，因为前面已经使用了编译器默认的拷贝构造函数，并不会引发无穷递归的问题。</p>
<p>但是最好加上引用，可以减少一些拷贝的消耗。</p>
<p>而使用<code>const</code>可以保护<code>d</code>对象在函数内不被更改，并且又能使用引用提高效率。</p>
<p>另外如果您对类的<code>this</code>指针还不够熟悉，这里显式的写下编译器处理后的代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.赋值运算符重载函数</span></span><br><span class="line"><span class="comment">//d2 = d3 --&gt; d2.operator=(&amp;d2, d3)</span></span><br><span class="line"><span class="type">void</span> <span class="keyword">operator</span>=(<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_year = d._year;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_month = d._month;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_day = d._day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外还有两个点需要注意，上述代码还没有办法实现连续赋值：<code>d1 = d2 = d3</code>的情况，因此我们还需要进行修改：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.赋值运算符重载函数</span></span><br><span class="line"><span class="comment">//d2 = d3 --&gt; d2.operator=(&amp;d2, d3)</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    _year = d._year;</span><br><span class="line">    _month = d._month;</span><br><span class="line">    _day = d._day;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以及如果出现自己赋值给自己的情况，上面的代码还可以再优化一些：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.赋值运算符重载函数</span></span><br><span class="line"><span class="comment">//d2 = d3 --&gt; d2.operator=(&amp;d2, d3)</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;d) </span><br><span class="line">    &#123;    </span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;<span class="comment">//处理自我赋值的情况</span></span><br><span class="line">    &#125;</span><br><span class="line">    _year = d._year;</span><br><span class="line">    _month = d._month;</span><br><span class="line">    _day = d._day;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者写成下面这样更加简洁：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.赋值运算符重载函数</span></span><br><span class="line"><span class="comment">//d2 = d3 --&gt; d2.operator=(&amp;d2, d3)</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;d) </span><br><span class="line">    &#123;    </span><br><span class="line">        _year = d._year;</span><br><span class="line">        _month = d._month;</span><br><span class="line">        _day = d._day;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;<span class="comment">//也可以处理自我赋值的情况</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，一定要注意拷贝构造和赋值重载的区别，前者重点在于构造，后者在于赋值。</p>
<h2 id="2-4-算术运算符重载函数"><a href="#2-4-算术运算符重载函数" class="headerlink" title="2.4.算术运算符重载函数"></a>2.4.算术运算符重载函数</h2><p>接下来我们来实现一些合理的算术运算符号。</p>
<h3 id="2-4-1-、-符号"><a href="#2-4-1-、-符号" class="headerlink" title="2.4.1.+&#x3D;、+符号"></a>2.4.1.+&#x3D;、+符号</h3><p>有的时候我们希望一个日期加上一个数字得到一个新的数字。例如：<code>2023年9月1日 + 1 = 2023年9月2日</code>。我们可以通过重载<code>+=</code>、<code>+</code>来实现这一思路。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//日期+=天数重载</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>+=(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    _day += day;<span class="comment">//先不管3721，直接加上就行</span></span><br><span class="line">    <span class="type">int</span> days = <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//获取这个月的天数</span></span><br><span class="line">    <span class="keyword">while</span> (_day &gt; days)<span class="comment">//如果天数是不正确的就进入循环</span></span><br><span class="line">    &#123;</span><br><span class="line">        _month++;<span class="comment">//天数多了就加月份</span></span><br><span class="line">        _day -= days;<span class="comment">//并且把天数减小一些</span></span><br><span class="line">        <span class="keyword">if</span> (_month == <span class="number">13</span>)<span class="comment">//如果月份超过了就加年份</span></span><br><span class="line">        &#123;</span><br><span class="line">            _year++;</span><br><span class="line">            _month = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        days = <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//重新获取正确的天数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//日期+天数运算符重载</span></span><br><span class="line">Date <span class="keyword">operator</span>+(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">    <span class="keyword">return</span> cache += day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以复用<code>+=</code>来实现<code>+</code>的功能，实际上反过来也是可以的，例如下面的写法：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//日期+=天数重载</span></span><br><span class="line">Date <span class="keyword">operator</span>+(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//复制一份+左边的操作数</span></span><br><span class="line">    cache._day += day;</span><br><span class="line">    <span class="type">int</span> days = <span class="built_in">GetMonthDay</span>(cache._year, cache._month);<span class="comment">//获取这个月的天数</span></span><br><span class="line">    <span class="keyword">while</span> (cache._day &gt; days)<span class="comment">//如果天数是不正确的就进入循环</span></span><br><span class="line">    &#123;</span><br><span class="line">        cache._month++;<span class="comment">//天数多了就加月份</span></span><br><span class="line">        cache._day -= days;<span class="comment">//并且把天数减小一些</span></span><br><span class="line">        <span class="keyword">if</span> (cache._month == <span class="number">13</span>)<span class="comment">//如果月份超过了就加年份</span></span><br><span class="line">        &#123;</span><br><span class="line">            (cache._year)++;</span><br><span class="line">            (cache._month) = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        days = <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//重新获取正确的天数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cache;</span><br><span class="line">&#125;</span><br><span class="line">Date&amp; <span class="keyword">operator</span>+=(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    *<span class="keyword">this</span> = *<span class="keyword">this</span> + day;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//日期+天数运算符重载</span></span><br></pre></td></tr></table></figure>

<p>那么哪一种写法好呢？第一种好，为什么呢？</p>
<ol>
<li><p>因为第一种的<code>+</code>有两次拷贝构造（一次在<code>cache</code>、一次在返回值）第二种的<code>+</code>也有两次拷贝构造（一次在<code>cache</code>，一次在返回值）。</p>
</li>
<li><p>但是第一种的<code>+=</code>没有调用拷贝构造，第二种的<code>+=</code>调用了两次拷贝和一次赋值（因为<code>+=</code>内部调用了重载的<code>+</code>就又调用了两次拷贝构造）。</p>
</li>
</ol>
<h3 id="2-4-2-、-符号"><a href="#2-4-2-、-符号" class="headerlink" title="2.4.2.-&#x3D;、-符号"></a>2.4.2.-&#x3D;、-符号</h3><p>这里我们直接复用<code>-=</code>给<code>-</code>使用，为什么不反过来复用的理由和上面类似，这里不再赘述。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//日期-=天数运算符重载</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>-=(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    _day -= day;<span class="comment">//先不管3721，直接减去就行</span></span><br><span class="line">    <span class="keyword">while</span> (_day &lt;= <span class="number">0</span>)<span class="comment">//如果天数是不正确的就进入循环</span></span><br><span class="line">    &#123;</span><br><span class="line">        _month--;<span class="comment">//减去月份</span></span><br><span class="line">        <span class="keyword">if</span> (_month == <span class="number">0</span>)<span class="comment">//如果月份为0了就减去年份，并且重置月份</span></span><br><span class="line">        &#123;</span><br><span class="line">            _year--;</span><br><span class="line">            _month = <span class="number">12</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        _day += <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//重新获取正确的天数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//日期-天数运算符重载</span></span><br><span class="line">Date <span class="keyword">operator</span>-(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">    <span class="keyword">return</span> cache -= day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-3-和-的优化"><a href="#2-4-3-和-的优化" class="headerlink" title="2.4.3.+&#x3D;和-&#x3D;的优化"></a>2.4.3.+&#x3D;和-&#x3D;的优化</h3><p>这里还有一个问题，如果“加上负数”或者“减去负数”怎么办？会产生一些小<code>bug</code>，我们可以通过一些调整来优化：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//日期+=天数重载</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>+=(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (day &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span> -= (-day);</span><br><span class="line">    &#125;</span><br><span class="line">    _day += day;<span class="comment">//先不管3721，直接加上就行</span></span><br><span class="line">    <span class="type">int</span> days = <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//获取这个月的天数</span></span><br><span class="line">    <span class="keyword">while</span> (_day &gt; days)<span class="comment">//如果天数是不正确的就进入循环</span></span><br><span class="line">    &#123;</span><br><span class="line">        _month++;<span class="comment">//天数多了就加月份</span></span><br><span class="line">        _day -= days;<span class="comment">//并且把天数减小一些</span></span><br><span class="line">        <span class="keyword">if</span> (_month == <span class="number">13</span>)<span class="comment">//如果月份超过了就加年份</span></span><br><span class="line">        &#123;</span><br><span class="line">            _year++;</span><br><span class="line">            _month = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        days = <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//重新获取正确的天数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//日期+天数运算符重载</span></span><br><span class="line">Date <span class="keyword">operator</span>+(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">    <span class="keyword">return</span> cache += day;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//日期-=天数运算符重载</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>-=(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (day &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span> += (-day);</span><br><span class="line">    &#125;</span><br><span class="line">    _day -= day;<span class="comment">//先不管3721，直接减去就行</span></span><br><span class="line">    <span class="keyword">while</span> (_day &lt;= <span class="number">0</span>)<span class="comment">//如果天数是不正确的就进入循环</span></span><br><span class="line">    &#123;</span><br><span class="line">        _month--;<span class="comment">//减去月份</span></span><br><span class="line">        <span class="keyword">if</span> (_month == <span class="number">0</span>)<span class="comment">//如果月份为0了就减去年份，并且重置月份</span></span><br><span class="line">        &#123;</span><br><span class="line">            _year--;</span><br><span class="line">            _month = <span class="number">12</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        _day += <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//重新获取正确的天数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//日期-天数运算符重载</span></span><br><span class="line">Date <span class="keyword">operator</span>-(<span class="type">int</span> day)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">    <span class="keyword">return</span> cache -= day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-4-、–的实现"><a href="#2-4-4-、–的实现" class="headerlink" title="2.4.4.++、–的实现"></a>2.4.4.++、–的实现</h3><p>这两个运算符要注意一个问题：“如何区分前置和后者？”<code>C++</code>为了解决这个问题专门做了区分，书写“运算符重载”的时候，前置符号正常书写即可，但后置符号需要在重载函数中填入<code>int</code>来和前置符号进行区分。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//前置++运算符重载</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>++()<span class="comment">//展开为Date&amp; operator++(const Date* this)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (*<span class="keyword">this</span>) += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//后置++运算符重载</span></span><br><span class="line">Date <span class="keyword">operator</span>++(<span class="type">int</span>)<span class="comment">//展开为Date&amp; operator++(const Date* this, int x)，这里的x会自动传值为0或者其他数，只要编译器能够识别即可，反正接受了也没在函数内使用没有影响，只是做一个区分</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">    *<span class="keyword">this</span> += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> cache;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//前置--运算符重载</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>--()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (*<span class="keyword">this</span> -= <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//后置--运算符重载</span></span><br><span class="line">Date <span class="keyword">operator</span>--(<span class="type">int</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">    *<span class="keyword">this</span> -= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此实际上有些语言为了避免这种问题，直接去掉了<code>++</code>和<code>--</code>运算符。</p>
<h3 id="2-4-5-日期-日期的实现"><a href="#2-4-5-日期-日期的实现" class="headerlink" title="2.4.5.日期-日期的实现"></a>2.4.5.日期-日期的实现</h3><p>有的时候也需要计算两个日期之间的天数。</p>
<p>如果直接计算日期减去日期会很麻烦，我们可以让小的那个日期递增到大的哪个日期，并且使用一个变量充当计数器来记录天数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//日期-日期=返回天数运算符重载</span></span><br><span class="line"><span class="type">int</span> <span class="keyword">operator</span>-(<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//以下方法一、二是本质是没什么区别的，但是方法一返回的是正数，方法二返回的数带有符号</span></span><br><span class="line">    <span class="comment">//1.方法一</span></span><br><span class="line">    <span class="comment">//Date cache(d);</span></span><br><span class="line">    <span class="comment">//int flag = 0;</span></span><br><span class="line">    <span class="comment">//while ((*this) &gt; cache)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    ++cache;</span></span><br><span class="line">    <span class="comment">//    ++flag;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="comment">//while ((*this) &lt; cache)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    --cache;</span></span><br><span class="line">    <span class="comment">//    ++flag;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="comment">//return flag;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.方法二</span></span><br><span class="line">    Date max = *<span class="keyword">this</span>;</span><br><span class="line">    Date min = d;</span><br><span class="line">    <span class="type">int</span> flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (*<span class="keyword">this</span> &lt; d)</span><br><span class="line">    &#123;</span><br><span class="line">        max = d;</span><br><span class="line">        min = *<span class="keyword">this</span>;</span><br><span class="line">        flag = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (min != max)</span><br><span class="line">    &#123;</span><br><span class="line">        min++;</span><br><span class="line">        n++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n * flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-5-逻辑运算符重载函数"><a href="#2-5-逻辑运算符重载函数" class="headerlink" title="2.5.逻辑运算符重载函数"></a>2.5.逻辑运算符重载函数</h2><p>接下来我们来实现一些合理的逻辑运算符号。例如：判断两个日期是否相等，哪一个日期是比较大的（<code>2023年7月1日</code>比<code>2022年8月9日</code>大）。</p>
<p>这里简单看一下即可：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&gt;运算符重载</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_year &gt; d._year)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (_year == d._year)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_month &gt; d._month)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (_month == d._month)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_day &gt; d._day)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//==运算符重载</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_year == d._year &amp;&amp; _month == d._month &amp;&amp; _day == d._day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//!=运算符重载</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> != (<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (*<span class="keyword">this</span> == d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&gt;=运算符重载</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &gt;= (<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt; d || (*<span class="keyword">this</span>) == d)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&lt;运算符重载</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt;= d)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&lt;=运算符重载</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &lt;= (<span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt; d)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-日期类具体实现（完整）"><a href="#3-日期类具体实现（完整）" class="headerlink" title="3.日期类具体实现（完整）"></a>3.日期类具体实现（完整）</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//获取某年某月的天数</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetMonthDay</span><span class="params">(<span class="type">int</span> year, <span class="type">int</span> month)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">static</span> <span class="type">int</span> monthDays[<span class="number">13</span>] = &#123; <span class="number">0</span>, <span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span> &#125;;<span class="comment">//这个静态的编写是因为GetMonthDay有可能会被频繁调用，那么monthDays数组就会不断的被创建，虽然这点消耗挺小，但是如果加上静态关键字，这个数组就会一直存在，不会被反复创建，节省资源。</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        一个年份是闰年的条件如下：</span></span><br><span class="line"><span class="comment">        1.如果该年份能够被4整除，但不能被100整除，则为闰年。例如：2008年、2012年等。</span></span><br><span class="line"><span class="comment">        2.如果该年份能够被400整除，则也是闰年。例如：2000年、2400年等。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (month == <span class="number">2</span></span><br><span class="line">            &amp;&amp; ((year % <span class="number">4</span> == <span class="number">0</span>) &amp;&amp; ((year % <span class="number">100</span> != <span class="number">0</span>) || (year % <span class="number">400</span> == <span class="number">0</span>)))</span><br><span class="line">            )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">29</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> monthDays[month];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//1.全缺省的构造函数（使用了初始化列表）</span></span><br><span class="line">    <span class="built_in">Date</span>(<span class="type">int</span> year = <span class="number">1900</span>, <span class="type">int</span> month = <span class="number">1</span>, <span class="type">int</span> day = <span class="number">1</span>)</span><br><span class="line">        : _year(year),</span><br><span class="line">        _month(month),</span><br><span class="line">        _day(day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((_month &lt; <span class="number">1</span>) || (_month &gt; <span class="number">12</span>) </span><br><span class="line">            || _day &lt; <span class="number">1</span> || (<span class="built_in">GetMonthDay</span>(_year, _month) &lt; _day))<span class="comment">//检查日期是否非法</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;非法日期：&quot;</span>;</span><br><span class="line">            <span class="built_in">Print</span>();</span><br><span class="line">            cout &lt;&lt; endl;</span><br><span class="line">            <span class="comment">//exit(-1);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.拷贝构造函数</span></span><br><span class="line">    <span class="comment">//d2(d1)</span></span><br><span class="line">    <span class="comment">//Date(const Date&amp; d)//实际上不用自己写</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">        <span class="comment">//_year = d._year;</span></span><br><span class="line">        <span class="comment">//_month = d._month;</span></span><br><span class="line">        <span class="comment">//_day = d._day;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="comment">//3.赋值运算符重载函数</span></span><br><span class="line">    <span class="comment">//d2 = d3 --&gt; d2.operator=(&amp;d2, d3)</span></span><br><span class="line">    <span class="comment">//Date&amp; operator=(const Date&amp; d)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    if (this != &amp;d) </span></span><br><span class="line">    <span class="comment">//    &#123;</span></span><br><span class="line">    <span class="comment">//        _year = d._year;</span></span><br><span class="line">    <span class="comment">//        _month = d._month;</span></span><br><span class="line">    <span class="comment">//        _day = d._day;</span></span><br><span class="line">    <span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//    return *this;//处理自我赋值的情况</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="comment">//4.析构函数</span></span><br><span class="line">    <span class="comment">//~Date()</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    cout &lt;&lt; &quot;析构函数在这个日期类里面没有太大用处:~Data()&quot; &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="comment">//5.符号重载函数</span></span><br><span class="line">    <span class="comment">//日期+=天数重载</span></span><br><span class="line">    Date&amp; <span class="keyword">operator</span>+=(<span class="type">int</span> day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (day &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span> -= (-day);</span><br><span class="line">        &#125;</span><br><span class="line">        _day += day;<span class="comment">//先不管3721，直接加上就行</span></span><br><span class="line">        <span class="type">int</span> days = <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//获取这个月的天数</span></span><br><span class="line">        <span class="keyword">while</span> (_day &gt; days)<span class="comment">//如果天数是不正确的就进入循环</span></span><br><span class="line">        &#123;</span><br><span class="line">            _month++;<span class="comment">//天数多了就加月份</span></span><br><span class="line">            _day -= days;<span class="comment">//并且把天数减小一些</span></span><br><span class="line">            <span class="keyword">if</span> (_month == <span class="number">13</span>)<span class="comment">//如果月份超过了就加年份</span></span><br><span class="line">            &#123;</span><br><span class="line">                _year++;</span><br><span class="line">                _month = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            days = <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//重新获取正确的天数</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//日期+天数运算符重载</span></span><br><span class="line">    Date <span class="keyword">operator</span>+(<span class="type">int</span> day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">        <span class="keyword">return</span> cache += day;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//日期-=天数运算符重载</span></span><br><span class="line">    Date&amp; <span class="keyword">operator</span>-=(<span class="type">int</span> day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (day &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span> += (-day);</span><br><span class="line">        &#125;</span><br><span class="line">        _day -= day;<span class="comment">//先不管3721，直接减去就行</span></span><br><span class="line">        <span class="keyword">while</span> (_day &lt;= <span class="number">0</span>)<span class="comment">//如果天数是不正确的就进入循环</span></span><br><span class="line">        &#123;</span><br><span class="line">            _month--;<span class="comment">//减去月份</span></span><br><span class="line">            <span class="keyword">if</span> (_month == <span class="number">0</span>)<span class="comment">//如果月份为0了就减去年份，并且重置月份</span></span><br><span class="line">            &#123;</span><br><span class="line">                _year--;</span><br><span class="line">                _month = <span class="number">12</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            _day += <span class="built_in">GetMonthDay</span>(_year, _month);<span class="comment">//重新获取正确的天数</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//日期-天数运算符重载</span></span><br><span class="line">    Date <span class="keyword">operator</span>-(<span class="type">int</span> day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">        <span class="keyword">return</span> cache -= day;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//前置++运算符重载</span></span><br><span class="line">    Date&amp; <span class="keyword">operator</span>++()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (*<span class="keyword">this</span>) += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//后置++运算符重载</span></span><br><span class="line">    Date <span class="keyword">operator</span>++(<span class="type">int</span>)<span class="comment">//展开为Date&amp; operator++(const Date* this, int x)，这里的x会自动传值为0或者其他数，只要编译器能够识别即可，反正接受了也没在函数内使用没有影响，只是做一个区分</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">        *<span class="keyword">this</span> += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//前置--运算符重载</span></span><br><span class="line">    Date&amp; <span class="keyword">operator</span>--()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (*<span class="keyword">this</span> -= <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//后置--运算符重载</span></span><br><span class="line">    Date <span class="keyword">operator</span>--(<span class="type">int</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;<span class="comment">//拷贝一份原有的*this</span></span><br><span class="line">        *<span class="keyword">this</span> -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&gt;运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_year &gt; d._year)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (_year == d._year)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_month &gt; d._month)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_month == d._month)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_day &gt; d._day)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//==运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_year == d._year &amp;&amp; _month == d._month &amp;&amp; _day == d._day)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//!=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> != (<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (*<span class="keyword">this</span> == d)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&gt;=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &gt;= (<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt; d || (*<span class="keyword">this</span>) == d)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&lt;运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt;= d)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&lt;=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt;= (<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt; d)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//日期-日期=返回天数运算符重载</span></span><br><span class="line">    <span class="type">int</span> <span class="keyword">operator</span>-(<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//以下方法一、二是本质是没什么区别的，但是方法一返回的是正数，方法二返回的数带有符号</span></span><br><span class="line">        <span class="comment">//1.方法一</span></span><br><span class="line">        <span class="comment">//Date cache(d);</span></span><br><span class="line">        <span class="comment">//int flag = 0;</span></span><br><span class="line">        <span class="comment">//while ((*this) &gt; cache)</span></span><br><span class="line">        <span class="comment">//&#123;</span></span><br><span class="line">        <span class="comment">//    ++cache;</span></span><br><span class="line">        <span class="comment">//    ++flag;</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">        <span class="comment">//while ((*this) &lt; cache)</span></span><br><span class="line">        <span class="comment">//&#123;</span></span><br><span class="line">        <span class="comment">//    --cache;</span></span><br><span class="line">        <span class="comment">//    ++flag;</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">        <span class="comment">//return flag;</span></span><br><span class="line">        <span class="comment">//2.方法二</span></span><br><span class="line">        Date max = *<span class="keyword">this</span>;</span><br><span class="line">        Date min = d;</span><br><span class="line">        <span class="type">int</span> flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (*<span class="keyword">this</span> &lt; d)</span><br><span class="line">        &#123;</span><br><span class="line">            max = d;</span><br><span class="line">            min = *<span class="keyword">this</span>;</span><br><span class="line">            flag = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (min != max)</span><br><span class="line">        &#123;</span><br><span class="line">            min++;</span><br><span class="line">            n++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n * flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.打印日期类函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; _year &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; _month &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; _day &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _year;</span><br><span class="line">    <span class="type">int</span> _month;</span><br><span class="line">    <span class="type">int</span> _day;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="4-日期类具体实现（精简）"><a href="#4-日期类具体实现（精简）" class="headerlink" title="4.日期类具体实现（精简）"></a>4.日期类具体实现（精简）</h1><p>这里省略了很多重复的注释，并且给出了一个完整的日期类。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//获取某年某月的天数</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetMonthDay</span><span class="params">(<span class="type">int</span> year, <span class="type">int</span> month)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">static</span> <span class="type">int</span> monthDays[<span class="number">13</span>] = &#123; <span class="number">0</span>, <span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span> &#125;;</span><br><span class="line">        <span class="keyword">if</span> (month == <span class="number">2</span></span><br><span class="line">            &amp;&amp; ((year % <span class="number">4</span> == <span class="number">0</span>) &amp;&amp; ((year % <span class="number">100</span> != <span class="number">0</span>) || (year % <span class="number">400</span> == <span class="number">0</span>)))</span><br><span class="line">            )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">29</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> monthDays[month];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//1.全缺省的构造函数（使用了初始化列表）</span></span><br><span class="line">    <span class="built_in">Date</span>(<span class="type">int</span> year = <span class="number">1900</span>, <span class="type">int</span> month = <span class="number">1</span>, <span class="type">int</span> day = <span class="number">1</span>)</span><br><span class="line">        : _year(year),</span><br><span class="line">        _month(month),</span><br><span class="line">        _day(day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((_month &lt; <span class="number">1</span>) || (_month &gt; <span class="number">12</span>)</span><br><span class="line">            || _day &lt; <span class="number">1</span> || (<span class="built_in">GetMonthDay</span>(_year, _month) &lt; _day))</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;非法日期：&quot;</span>;</span><br><span class="line">            <span class="built_in">Print</span>();</span><br><span class="line">            cout &lt;&lt; endl;</span><br><span class="line">            <span class="comment">//exit(-1);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.运算符重载函数</span></span><br><span class="line">    Date&amp; <span class="keyword">operator</span>+=(<span class="type">int</span> day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (day &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span> -= (-day);</span><br><span class="line">        &#125;</span><br><span class="line">        _day += day;</span><br><span class="line">        <span class="type">int</span> days = <span class="built_in">GetMonthDay</span>(_year, _month);</span><br><span class="line">        <span class="keyword">while</span> (_day &gt; days)</span><br><span class="line">        &#123;</span><br><span class="line">            _month++;</span><br><span class="line">            _day -= days;</span><br><span class="line">            <span class="keyword">if</span> (_month == <span class="number">13</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _year++;</span><br><span class="line">                _month = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            days = <span class="built_in">GetMonthDay</span>(_year, _month);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//日期+天数运算符重载</span></span><br><span class="line">    Date <span class="keyword">operator</span>+(<span class="type">int</span> day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</span><br><span class="line">        <span class="keyword">return</span> cache += day;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//日期-=天数运算符重载</span></span><br><span class="line">    Date&amp; <span class="keyword">operator</span>-=(<span class="type">int</span> day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (day &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span> += (-day);</span><br><span class="line">        &#125;</span><br><span class="line">        _day -= day;</span><br><span class="line">        <span class="keyword">while</span> (_day &lt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            _month--;</span><br><span class="line">            <span class="keyword">if</span> (_month == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _year--;</span><br><span class="line">                _month = <span class="number">12</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            _day += <span class="built_in">GetMonthDay</span>(_year, _month);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//日期-天数运算符重载</span></span><br><span class="line">    Date <span class="keyword">operator</span>-(<span class="type">int</span> day)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</span><br><span class="line">        <span class="keyword">return</span> cache -= day;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//前置++运算符重载</span></span><br><span class="line">    Date&amp; <span class="keyword">operator</span>++()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (*<span class="keyword">this</span>) += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//后置++运算符重载</span></span><br><span class="line">    Date <span class="keyword">operator</span>++(<span class="type">int</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</span><br><span class="line">        *<span class="keyword">this</span> += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//前置--运算符重载</span></span><br><span class="line">    Date&amp; <span class="keyword">operator</span>--()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (*<span class="keyword">this</span> -= <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//后置--运算符重载</span></span><br><span class="line">    Date <span class="keyword">operator</span>--(<span class="type">int</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Date <span class="title">cache</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</span><br><span class="line">        *<span class="keyword">this</span> -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&gt;运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_year &gt; d._year)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (_year == d._year)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_month &gt; d._month)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_month == d._month)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_day &gt; d._day)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//==运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_year == d._year &amp;&amp; _month == d._month &amp;&amp; _day == d._day)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//!=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> != (<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (*<span class="keyword">this</span> == d)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&gt;=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &gt;= (<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt; d || (*<span class="keyword">this</span>) == d)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&lt;运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt;= d)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&lt;=运算符重载</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt;= (<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*<span class="keyword">this</span>) &gt; d)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//日期-日期=返回天数运算符重载</span></span><br><span class="line">    <span class="type">int</span> <span class="keyword">operator</span>-(<span class="type">const</span> Date&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">        Date max = *<span class="keyword">this</span>;</span><br><span class="line">        Date min = d;</span><br><span class="line">        <span class="type">int</span> flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (*<span class="keyword">this</span> &lt; d)</span><br><span class="line">        &#123;</span><br><span class="line">            max = d;</span><br><span class="line">            min = *<span class="keyword">this</span>;</span><br><span class="line">            flag = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (min != max)</span><br><span class="line">        &#123;</span><br><span class="line">            min++;</span><br><span class="line">            n++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n * flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.打印日期类函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; _year &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; _month &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; _day &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _year;</span><br><span class="line">    <span class="type">int</span> _month;</span><br><span class="line">    <span class="type">int</span> _day;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>另外，我们也可以给只读成员函数加上<code>const</code>，上述代码在碰到<code>const</code>的<code>Date</code>对象时，调用成员函数可能会出现权限放大的问题，您可以自行修改一下……</p>
<h1 id="5-日期类测试样例（测试）"><a href="#5-日期类测试样例（测试）" class="headerlink" title="5.日期类测试样例（测试）"></a>5.日期类测试样例（测试）</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.检测合法性是否成立</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;1.检测合法性是否成立&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="function">Date <span class="title">d0</span><span class="params">(<span class="number">2023</span>, <span class="number">2</span>, <span class="number">31</span>)</span></span>;</span><br><span class="line">    <span class="comment">//2.检测构造函数的运行</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;2.检测构造函数的运行&quot;</span> &lt;&lt; endl;</span><br><span class="line">    Date d1;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Data d1, d1:&quot;</span>;</span><br><span class="line">    d1.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.检测拷贝构造函数和赋值重载函数</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;3.检测拷贝构造函数和赋值重载函数&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="function">Date <span class="title">d2</span><span class="params">(d1)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Data d2(d1), d2:&quot;</span>;</span><br><span class="line">    d2.<span class="built_in">Print</span>();</span><br><span class="line">    <span class="function">Date <span class="title">d3</span><span class="params">(<span class="number">2000</span>, <span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Data d3(2000, 1, 1), d3:&quot;</span>;</span><br><span class="line">    d3.<span class="built_in">Print</span>();</span><br><span class="line">    d2 = d3;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d2 = d3&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d2 = &quot;</span>;</span><br><span class="line">    d2.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d3 = &quot;</span>;</span><br><span class="line">    d3.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.检测逻辑运算符</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;4.检测逻辑运算符&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="type">int</span> a = (d1 == d2);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;int a = (d1 == d2), a:&quot;</span>;</span><br><span class="line">    cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    <span class="type">int</span> b = (d1 != d3);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;int b = (d1 != d3), b:&quot;</span>;</span><br><span class="line">    cout &lt;&lt; b &lt;&lt; endl  &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.检测算术运算符</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;5.检测算术运算符&quot;</span> &lt;&lt; endl;</span><br><span class="line">    d1 = d3;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d1 = d3, d1:&quot;</span>;</span><br><span class="line">    d1.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> days = d1.<span class="built_in">GetMonthDay</span>(<span class="number">2016</span>, <span class="number">1</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;days = d1.GetMonthDay(2016, 1), days = &quot;</span> &lt;&lt; days &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    d1 += <span class="number">3653</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d1 += 3653, d1:&quot;</span>;</span><br><span class="line">    d1.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">    d2 = d1 + <span class="number">3653</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d2 = d1 + 3653, d1:&quot;</span>;</span><br><span class="line">    d1.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d2 = d1 + 3653, d2:&quot;</span>;</span><br><span class="line">    d2.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">    d1 -= <span class="number">3653</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d1 -= 3653, d1:&quot;</span>;</span><br><span class="line">    d1.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">    d2 = d1 - <span class="number">33456</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d2 = d1 - 33456, d1:&quot;</span>;</span><br><span class="line">    d1.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d2 = d1 - 33456, d2:&quot;</span>;</span><br><span class="line">    d2.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    <span class="function">Date <span class="title">d4</span><span class="params">(<span class="number">2023</span>, <span class="number">7</span>, <span class="number">22</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(++d4).Print(), ++d4之前:&quot;</span>;</span><br><span class="line">    (++d4).<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(++d4).Print(), ++d4之后:&quot;</span>;</span><br><span class="line">    d4.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d4++.Print(), d4++之前:&quot;</span>;</span><br><span class="line">    (d4++).<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d4++.Print(), d4++之后:&quot;</span>;</span><br><span class="line">    d4.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(--d4).Print(), --d4之前:&quot;</span>;</span><br><span class="line">    (--d4).<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(--d4).Print(), --d4之后:&quot;</span>;</span><br><span class="line">    d4.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(d4--).Print(), d4--之前:&quot;</span>;</span><br><span class="line">    (d4--).<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(d4--).Print(), d4--之后:&quot;</span>;</span><br><span class="line">    d4.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.检测逻辑运算符</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;6.检测逻辑运算符&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="function">Date <span class="title">d5</span><span class="params">(<span class="number">2016</span>, <span class="number">10</span>, <span class="number">6</span>)</span></span>;</span><br><span class="line">    <span class="function">Date <span class="title">d6</span><span class="params">(<span class="number">2016</span>, <span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="function">Date <span class="title">d7</span><span class="params">(<span class="number">2010</span>, <span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="function">Date <span class="title">d8</span><span class="params">(<span class="number">2010</span>, <span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d5 = &quot;</span>;</span><br><span class="line">    d5.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d6 = &quot;</span>;</span><br><span class="line">    d6.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d7 = &quot;</span>;</span><br><span class="line">    d7.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d8 = &quot;</span>;</span><br><span class="line">    d8.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (d5 &gt; d7)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;d5 &gt; d7&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (d7 &gt;= d8)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;d7 &gt;= d8&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (d5 &gt;= d8)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;d5 &gt;= d8&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (d6 &lt; d5)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;d6 &lt; d5&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (d7 &lt;= d8)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;d7 &lt;= d8&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (d7 &lt;= d6)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;d7 &lt;= d6&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.检测日期-日期</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;7.检测日期-日期&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">Date <span class="title">d9</span><span class="params">(<span class="number">2023</span>, <span class="number">7</span>, <span class="number">27</span>)</span></span>;</span><br><span class="line">    <span class="function">Date <span class="title">d10</span><span class="params">(<span class="number">2003</span>, <span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d9 = &quot;</span>;</span><br><span class="line">    d9.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d10 = &quot;</span>;</span><br><span class="line">    d10.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d9 - d10 = &quot;</span> &lt;&lt; d9 - d10 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d10 - d9 = &quot;</span> &lt;&lt; d10 - d9 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">Date <span class="title">d11</span><span class="params">(<span class="number">2016</span>, <span class="number">10</span>, <span class="number">6</span>)</span></span>;</span><br><span class="line">    <span class="function">Date <span class="title">d12</span><span class="params">(<span class="number">2023</span>, <span class="number">7</span>, <span class="number">22</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d11 = &quot;</span>;</span><br><span class="line">    d11.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d12 = &quot;</span>;</span><br><span class="line">    d12.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d12 - d11 = &quot;</span> &lt;&lt; d12 - d11 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d11 - d12 = &quot;</span> &lt;&lt; d11 - d12 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">Date <span class="title">d13</span><span class="params">(<span class="number">2015</span>, <span class="number">10</span>, <span class="number">6</span>)</span></span>;</span><br><span class="line">    <span class="function">Date <span class="title">d14</span><span class="params">(<span class="number">2015</span>, <span class="number">10</span>, <span class="number">6</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d13 = &quot;</span>;</span><br><span class="line">    d13.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d14 = &quot;</span>;</span><br><span class="line">    d14.<span class="built_in">Print</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d13 - d14 = &quot;</span> &lt;&lt; d13 - d14 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d14 - d13 = &quot;</span> &lt;&lt; d14 - d13 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-补充：流运算符重载问题"><a href="#6-补充：流运算符重载问题" class="headerlink" title="6.补充：流运算符重载问题"></a>6.补充：流运算符重载问题</h1><p>由于当前我们还没有学过<code>I/O流</code>，所以这一部分我单独拉了出来，您可以稍微看一下。</p>
<p>如果我们需要<code>Date</code>也可以实现下面的代码怎么办呢？</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span></span><br><span class="line">&#123;<span class="comment">/*...*/</span>&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Date d1;</span><br><span class="line">    Date d2;</span><br><span class="line">    std::cin &gt;&gt; d1 &gt;&gt; d2;</span><br><span class="line">    std::cout &lt;&lt; d1 &lt;&lt; d2 &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候我们就需要对<code>&lt;&lt;</code>和<code>&gt;&gt;</code>进行重载，但是首先我们需要了解<code>cin</code>和<code>cout</code>的本质。</p>
<p>两者实际上分别是<code>istream</code>和<code>otream</code>类构建出来的对象，因此在对<code>&lt;&lt;</code>和<code>&gt;&gt;</code>重载的时候需要注意这两个类。</p>
<p>一般情况下流运算符也只能写成全局函数，如果写成成员函数会显得很怪异：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//流重载函数（尝试内置在类中）</span></span><br><span class="line">istream&amp; <span class="keyword">operator</span>&gt;&gt;(istream&amp; in)</span><br><span class="line">&#123;</span><br><span class="line">    in &gt;&gt; _year &gt;&gt; _month &gt;&gt; _day;</span><br><span class="line">    <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line">ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; out)</span><br><span class="line">&#123;</span><br><span class="line">    out &lt;&lt; _year &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; _month &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; _day &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用函数的时候就只能像下面这样调用</span></span><br><span class="line">Date d1;</span><br><span class="line">Date d2;</span><br><span class="line">d1 &gt;&gt; (d2 &gt;&gt; cin);<span class="comment">//变成d1.operator&gt;&gt;( (d2.operator&gt;&gt;(cin) )</span></span><br><span class="line">d1 &lt;&lt; (d2 &lt;&lt; cout);<span class="comment">//变成d1.operator&lt;&lt;( (d2.operator&lt;&lt;(cout) )</span></span><br></pre></td></tr></table></figure>

<p>和普通的流运算符的使用有很大的不同，本质是因为<code>this</code>指针没办法改动位置，只能接受一个指向对象的指针，因此只能像下面这样书写代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//流重载函数（全局函数）</span></span><br><span class="line">istream&amp; <span class="keyword">operator</span>&gt;&gt;(istream&amp; in, Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    in &gt;&gt; d._year &gt;&gt; d._month &gt;&gt; d._day;</span><br><span class="line">    <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line">ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; out, <span class="type">const</span> Date&amp; d)</span><br><span class="line">&#123;</span><br><span class="line">    out &lt;&lt; d._year &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; d._month &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; d._day;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这样又有一个问题了，这两个重载的函数没有办法访问类私有变量（<code>private: _year;_month;_day;</code>），这个时候就需要在类里面加上友元。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//友元声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">friend</span> istream&amp; <span class="keyword">operator</span>&gt;&gt;(istream&amp; in, Date&amp; d);</span><br><span class="line">    <span class="keyword">friend</span> ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; out, <span class="type">const</span> Date&amp; d);</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为什么<code>C++</code>的要设定<code>cout</code>和<code>cin</code>，而不再使用<code>prinf()</code>等函数呢？就是为了更好得支持自定义类型，<code>C</code>的<code>printf()</code>还不够通用，尤其是后期涉及到范式编程的时候，这个问题就会更加凸显…</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/12/01/004+limou+2023_09_23+C++%E7%B1%BB%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0%EF%BC%88%E4%B8%8B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/12/01/004+limou+2023_09_23+C++%E7%B1%BB%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0%EF%BC%88%E4%B8%8B%EF%BC%89/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-12-01T16:34:49+08:00">
                2023-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<p>之前我们学习的模板能达到泛型的原因是：使用了“泛型的类型”，但是如果经过后面的“造轮子”（后面会尝试实现一下<code>STL</code>的一些类模板），就会很明显发现泛型不仅仅是类型的问题，例如：“适配器”的使用（在后面双端队列里有体现），实际上就是一种泛型，对于泛型的理解我们不能仅限于类型。</p>
<h1 id="1-非类型模板"><a href="#1-非类型模板" class="headerlink" title="1.非类型模板"></a>1.非类型模板</h1><p>模板除了类型模板，还有非类型模板。</p>
<ol>
<li><p>类型模板：出现在模板的参数列表中，跟在<code>class</code>或者<code>typname</code>后的参数类型名称</p>
</li>
<li><p>非类型模板：使用一个常量作为类的一个非类型模板参数，在模板类&#x2F;模板函数中可以将该参数作为常量来使用，且不能修改。并且，这里非类型模板参数也可以使用缺省值</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//没有非类型模板参数</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T _arr[NUM];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Data&lt;<span class="type">int</span>&gt; a1;</span><br><span class="line">    <span class="comment">//无法修改初始化大小（注意是初始化的时候修改大小）</span></span><br><span class="line">    <span class="comment">//只能手动调整#define的值</span></span><br><span class="line">    <span class="comment">//和之前的typedef的问题类似</span></span><br><span class="line">    Data&lt;<span class="type">double</span>&gt; a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候就可以使用非类型模板参数，这个参数是一个常量，更加准确来说是不可被修改的整形常量（包括布尔类型）。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有非类型模板参数</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//#define NUM 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="type">size_t</span> N = <span class="number">50</span>&gt;</span><br><span class="line"><span class="keyword">class</span> Data</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T _arr[N];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Data&lt;<span class="type">int</span>&gt; a1;<span class="comment">//默认初始化申请50个空间</span></span><br><span class="line">    Data&lt;<span class="type">double</span>, <span class="number">20</span>&gt; a2;<span class="comment">//初始化时申请20个空间</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可能会疑惑：为什么不可以初始化先使用<code>new</code>开辟固定的空间，等到后续操作进行扩容操作呢？注意这里只是利用这个例子来简述语法特性，并不是实际的用途（在后续“位图”等知识中有很大的价值）。</p>
<blockquote>
<p>  补充：除了使用这个常量，还可以将这个常量作为一个类的标识数字来使用。</p>
</blockquote>
<p>函数模板也可以使用这一特性。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="type">size_t</span> N = <span class="number">50</span>&gt;</span><br><span class="line"><span class="keyword">class</span> Data</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    T _arr[N];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="type">long</span> NUM = <span class="number">50</span>&gt;<span class="comment">//演示了其他整形</span></span><br><span class="line"><span class="type">void</span> <span class="built_in">function</span>(T&amp; i)</span><br><span class="line">&#123;</span><br><span class="line">    i = NUM;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Data&lt;<span class="type">int</span>, <span class="number">10</span>&gt; a1;</span><br><span class="line">    Data&lt;<span class="type">int</span>, <span class="number">100</span>&gt; a2;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">function</span>&lt;<span class="type">int</span>, <span class="number">200</span>&gt;(i);<span class="comment">//演示了函数修改非类型模板参数</span></span><br><span class="line">    cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>C++ 11</code>搞的新容器：静态数组<code>array</code>，其类模板就是使用了这个非类型模板参数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;array&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    array&lt;<span class="type">int</span>, 10&gt;arr;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : arr)</span><br><span class="line">    &#123;</span><br><span class="line">            i = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i : arr)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; i &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可惜静态数组不会进行初始化（吐槽：<code>std::array</code>当参数传递仍然要把数组的长度传过去，挺好玩的…），也支持范围<code>for</code>，并且越界检查比较严格（传统数组是抽查，但是静态数组是读写越界全面检查，避免代码崩溃）。</p>
<p>嘛…感觉优势不算很大（大不了使用<code>vector</code>，这也可以查找越界，还可以使用列表初始化）所以推广并不高。这个容器有点为了强迫症而统一<code>STL</code>风格的感觉。</p>
<p>类似<code>deque</code>在<code>list</code>和<code>vector</code>的感觉（后面会讲），静态数组就是传统数组和<code>vector</code>之间的方案。</p>
<h1 id="2-模板特化"><a href="#2-模板特化" class="headerlink" title="2.模板特化"></a>2.模板特化</h1><p>通常模板可以实现和类型无关的代码，但是有一些特殊的类型可能会得到一些错误的、不符合预期的结果，因此需要进行特殊处理，这就有了“模板特化”这个概念。</p>
<h2 id="2-1-类模板特化"><a href="#2-1-类模板特化" class="headerlink" title="2.1.类模板特化"></a>2.1.类模板特化</h2><h3 id="2-1-1-全特化"><a href="#2-1-1-全特化" class="headerlink" title="2.1.1.全特化"></a>2.1.1.全特化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T1</span>, <span class="keyword">class</span> <span class="title class_">T2</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Data</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Data&lt;T1, T2&gt;&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T1 _d1;</span><br><span class="line">    T2 _d2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;<span class="comment">//全特化，必须要写这句</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span>&lt;<span class="type">int</span>, <span class="type">char</span>&gt;<span class="comment">//这里指定了特定的类型</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Data</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Data&lt;int, char&gt;&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _d1;</span><br><span class="line">    <span class="type">char</span> _d2;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestVector</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Data&lt;<span class="type">int</span>, <span class="type">int</span>&gt; d1;</span><br><span class="line">    Data&lt;<span class="type">int</span>, <span class="type">char</span>&gt; d2;<span class="comment">//这样就会直接调用全特化的模板，不会再去类模板构造</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">TestVector</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-2-偏特化"><a href="#2-1-2-偏特化" class="headerlink" title="2.1.2.偏特化"></a>2.1.2.偏特化</h3><p>除了全特化，还可以进行偏特化。在下述代码中，我们可以看到偏特化不仅只是做了一些类型的指定，也可以对类型做进一步限制。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T1</span>, <span class="keyword">class</span> <span class="title class_">T2</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Data</span>(<span class="type">const</span> T1&amp; d1, <span class="type">const</span> T2&amp; d2) : _d1(d1), _d2(d2)</span><br><span class="line">    &#123; cout &lt;&lt; <span class="string">&quot;Data&lt;T1, T2&gt;&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T1 _d1;</span><br><span class="line">    T2 _d2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.部分类模板参数特化</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T1</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span>&lt;T1, <span class="type">int</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Data</span>(<span class="type">const</span> T1&amp; d1, <span class="type">const</span> <span class="type">int</span>&amp; d2) : _d1(d1), _d2(d2)</span><br><span class="line">    &#123; cout &lt;&lt; <span class="string">&quot;Data&lt;T1, int&gt;&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T1 _d1;</span><br><span class="line">    <span class="type">int</span> _d2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.1.对两个参数进行进一步限制，偏特化为指针类型</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;<span class="comment">//这里也是必须写，和全特化有些不同</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span> &lt;T1*, T2*&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Data</span>(<span class="type">const</span> T1&amp; d1, <span class="type">const</span> T2&amp; d2) : _d1(d1), _d2(d2)</span><br><span class="line">    &#123; cout &lt;&lt; <span class="string">&quot;Data&lt;T1*, T2*&gt;&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T1 _d1;<span class="comment">//注意其成员不是指针，仍然是原类型</span></span><br><span class="line">    T2 _d2;<span class="comment">//注意其成员不是指针，仍然是原类型</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.2.对两个参数进行进一步限制，偏特化为引用类型</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;<span class="comment">//这里也是必须写，和全特化有些不同</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span> &lt;T1&amp;, T2&amp;&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Data</span>(<span class="type">const</span> T1&amp; d1, <span class="type">const</span> T2&amp; d2) : _d1(d1), _d2(d2)</span><br><span class="line">    &#123;cout &lt;&lt; <span class="string">&quot;Data&lt;T1&amp;, T2&amp;&gt;&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T1 _d1;</span><br><span class="line">    T2 _d2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Data&lt;<span class="type">int</span>, <span class="type">double</span>&gt; <span class="title">d1</span><span class="params">(<span class="number">10</span>, <span class="number">20</span>)</span></span>;<span class="comment">//调用基础的类模板</span></span><br><span class="line">    <span class="function">Data&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">d2</span><span class="params">(<span class="number">30</span>, <span class="number">40</span>)</span></span>;<span class="comment">//调用偏特化的类模板</span></span><br><span class="line">    <span class="function">Data&lt;<span class="type">int</span>*, <span class="type">int</span>*&gt; <span class="title">d3</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;<span class="comment">//调用偏特化的指针版本</span></span><br><span class="line">    <span class="function">Data&lt;<span class="type">int</span>&amp;, <span class="type">int</span>&amp;&gt; <span class="title">d4</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;<span class="comment">//调用偏特化的引用版本</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  补充：偏特化会使得特化更加强大，某些程度上来说比全特化更加常用。</p>
</blockquote>
<p>因此可以总结类模板的特化语法就是：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.原类模板</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T1</span>, <span class="keyword">class</span> <span class="title class_">T2</span>, <span class="comment">/*...*/</span>, <span class="keyword">class</span> <span class="title class_">Tn</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassName</span></span><br><span class="line">&#123;<span class="comment">/*...*/</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.特化类模板</span></span><br><span class="line"><span class="keyword">template</span>&lt;/*填入仍旧继续使用的泛型（如果都使用可以省略这里）*/&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassName</span>&lt;/*指定特定的类型，并且写入仍旧使用的泛型，注意顺序*/&gt;</span><br><span class="line">&#123;<span class="comment">/*...*/</span>&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-函数模板特化"><a href="#2-2-函数模板特化" class="headerlink" title="2.2.函数模板特化"></a>2.2.函数模板特化</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//类模板</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Data</span>(<span class="type">int</span> d) : _d(d) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Data&amp; x)</span><br><span class="line">    &#123; <span class="keyword">return</span> _d &lt; x._d; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数模板</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Less</span><span class="params">(T left, T right)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> left &lt; right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//特化函数模板</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="type">bool</span> <span class="built_in">Less</span>&lt;Data*&gt;(Data* left, Data* right)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (*left) &lt; (*right);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">template&lt;&gt;</span></span><br><span class="line"><span class="comment">bool Less&lt;Data*&gt;(const Data* &amp; left, const Data* &amp; right)//这种写法很特殊，是没有办法通过的，原本是为了使用const修饰引用变量，避免引用变量被修改，但是由于指针和const修饰的特殊性，导致const修饰了*，因此只能改成：(Data* const&amp; left, Data* const&amp; right)这种写法虽然奇怪，但是却是正确的。</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    return (*left) &lt; (*right);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">Less</span>(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; endl;<span class="comment">//调用了普通的函数模板</span></span><br><span class="line"></span><br><span class="line">    <span class="function">Data <span class="title">d1</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="function">Data <span class="title">d2</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">Less</span>(d1, d2) &lt;&lt; endl;<span class="comment">//调用了普通的函数模板</span></span><br><span class="line"></span><br><span class="line">    Data* p1 = &amp;d1;</span><br><span class="line">    Data* p2 = &amp;d2;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">Less</span>(p1, p2) &lt;&lt; endl;<span class="comment">//调用特化后的函数模板，虽然这种调用看起来很奇怪</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意<code>1</code>：区分好“匹配”和“特化”和“实例化”。</p>
<ol>
<li><strong>匹配</strong>：是有相匹配的类型，可以使用对应的模板</li>
<li><strong>实例化</strong>：是编译器自己做的，将匹配对应的模板进行实例化</li>
<li><strong>特化</strong>：特化不是全新的模板，必须依赖模板，不可以单独存在</li>
</ol>
<p>注意<code>2</code>：实际上特化更加适合类模板一些，实际上函数重载（重载）对比函数模板特化（匹配）更加简单。</p>
</blockquote>
<h1 id="3-函数模板声明定义分离"><a href="#3-函数模板声明定义分离" class="headerlink" title="3.函数模板声明定义分离"></a>3.函数模板声明定义分离</h1><p>这一点凸显在函数的声明定义的分离上，假设有下面三个文件：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//function.h内声明</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function">T <span class="title">Add</span><span class="params">(<span class="type">const</span> T&amp; left, <span class="type">const</span> T&amp; right)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">NoTemplateAdd</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; left, <span class="type">const</span> <span class="type">int</span>&amp; right)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//function.cpp内定义</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function">T <span class="title">Add</span><span class="params">(<span class="type">const</span> T&amp; left, <span class="type">const</span> T&amp; right)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> left + right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">NoTemplateAdd</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; left, <span class="type">const</span> <span class="type">int</span>&amp; right)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> left + right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.cpp内包含头文件并且调用</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;function.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Add</span>(<span class="number">1</span>, <span class="number">2</span>);<span class="comment">//链接错误</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Add</span>(<span class="number">1.0</span>, <span class="number">2.0</span>);<span class="comment">//链接错误</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">NoTemplateAdd</span>(<span class="number">1</span>, <span class="number">2</span>);<span class="comment">//成功调用</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现函数模板没有办法声明和定义分离在两个文件中，会显示链接错误（但是普通的函数可以）。</p>
<p>让我们来分析一下这里面的原因：</p>
<ol>
<li><code>C/C++</code>要运行程序，就需要经历“预处理-编译-汇编-链接”</li>
<li>在编译阶段，会对多份源文件做各自的编译（进行词法、语法、语义分析、错误检查等）并且生成多份的汇编代码（注意头文件是不会参与编译的）这个时候在<code>function.obj</code>或者说<code>function.o</code>中，由于编译器没有看到函数的实例化，因此没有生成具体的加法函数。</li>
<li>而在<code>main.obj</code>或者<code>main.o</code>中，编译器看到有加法函数的调用，但是暂时不知道具体的实现，因此就暂时放进了符号表里等待后续链接</li>
<li>在链接阶段由于没有实例化，因此<code>function.obj</code>或者说<code>function.o</code>中没有加法函数的定义，根本就无法提供加法函数的地址在符号表里供<code>main.obj</code>或者<code>main.o</code>链接</li>
</ol>
<p>因此后续链接的时候就会报错，即“链接错误”。</p>
<p>如果一定要分离，有两种方法：</p>
<ol>
<li><p>进行显示实例化（有缺陷）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//function.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyFunction</span><span class="params">(T value)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//function.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;function.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyFunction</span><span class="params">(T value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; value &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//显式实例化int类型的函数模板</span></span><br><span class="line"><span class="keyword">template</span> <span class="type">void</span> <span class="built_in">MyFunction</span>&lt;<span class="type">int</span>&gt;(<span class="type">int</span> value);</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;function.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//调用int版本的函数模板</span></span><br><span class="line">    <span class="built_in">MyFunction</span>(<span class="number">42</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在一个翻译单元里分离，即：干脆直接将定义和声明都写在一个<code>.hpp</code>内（这样直接就有函数地址出来，不需要等待链接），这样做是更加推荐的。</p>
</li>
</ol>
<h1 id="4-可变参数模板"><a href="#4-可变参数模板" class="headerlink" title="4.可变参数模板"></a>4.可变参数模板</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
